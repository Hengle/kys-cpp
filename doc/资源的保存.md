
# 资源的保存以及abc工程

存档的基础数据部分（即r部分）可以保存为sqlite的数据库格式。可以通过读取和保存来转换已有存档。

之前游戏使用的列表文件只保留了升级经验列表和离队列表，改用txt格式。

存档文件的文本编码，仅有初始存档为cp950（BIG5），这是向下兼容的需要，但是内部会使用65001（utf-8），存档被保存后也会转为65001。存档中有一个标记位保存了该文件的编码。

若使用数据库，则只有utf-8。

abc工程用来转换之前的数据。建议自行调整代码后，使用调试模式执行。

其中主要的功能是将存档的R部分改为使用sqlite3的数据库保存。

存档的S和D部分仍使用16位整数，其余的还有一些其他文件也没有进行转换。

以上提到的数据，除了文本文件外均可以用真正的强强的新版upedit修改（该修改器不完善）。

游戏的资源文件是以单个图片的形式放在resource的各个目录中的，每张图的偏移保存在index.ka中，格式为每张图两个16位整数，连续存放。这种类型的目录也可以打包为zip格式。

战斗贴图文件中，每个人的帧数，之前在hugebase（水浒）框架中使用fightframe.ka保存，现改用fightframe.txt保存。格式为动作索引（0~4），每方向数量。未写则视为0。这种类型的目录也可以打包为zip格式。

## 关于图片偏移的补充

图片偏移目前统一置于index.ka文件中，修改有一定困难。一般情况可以使用修改器来调整。

也有一个思路是将偏移保存在png文件之中，需注意png文件本身是可以包含偏移的，但是一般情况是可选项。该思路基本验证通过，但是目前并没有使用。

在abc文件中有png_offset.h和png_offset.cpp文件，其中提供了修改png文件偏移的例程。libpng这个库的API接口有点古老，因此程序看起来比较繁琐。