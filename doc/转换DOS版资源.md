## 转换DOS版资源到kys的一般流程

### 图片资源

将“贴图”目录下的两个文件放到DOS游戏目录，执行批处理即可。

注意，战斗文件和头像文件是不需要闪烁的。

你也可以查看批处理的内容，自己进行一些设定。

战斗贴图还需要动作帧数，下面abc工程中会有介绍。

不会特别处理物品图像，建议自己重新选图。

该程序的使用方法为：
```
xia.exe idx文件名 grp文件名 输出目录 是否需要闪烁（0或1）
```
源码位于kys-tools下面。

### 事件和对话转为lua脚本

使用tools中的trans50命令行工具进行转换：

可以直接调用此处的批处理，即：

```
maketalk.bat path
make.bat path 
```
其中path即kdef和talk（包含idx和grp）所在的目录。

50指令及转译目前不能保证正确执行。


### 转换旧的存档和列表等

使用tools中的abc命令行工具。

因为转换基本是一次性的工作，对效率要求不高，但是需避免出错。故有些功能建议使用VS打开，在其中用Debug模式运行，

该工程最好用C++23或更新标准编译。

#### 转换存档为32位，生成数据库，以及战斗帧数

需注意先转换好fight的图片，才能生成战斗帧数。

一般使用以下命令就可以生成。如果保存的路径不一样，也可以用--path参数传递进去。更详细的内容请查看源码。

```
.\abc.exe --save
```

#### 验证战斗帧数

```c++
.\abc.exe --check-frame
```
主要用于检查帧数与贴图数是否一致，不能保证结果完全正确。

错误的部分建议手动修正。

需在生成帧数文件后执行。

#### 合并wmp到smp

```c++
.\abc.exe --combine-wmpsmp
```
用于将smp和wmp的图片资源和index.ka合并。

#### 分拆战斗效果图

eft图片在导出时为一个目录，分拆后可以更方便地替换和添加。但是这一步需要pascal复刻版的effect.bin文件。如果没有，请从z.dat文件中将这个列表手动复制出来。

```
.\abc.exe --split-eft
```
更建议重配eft图片。

### 后面的内容有可能不能自动完成，最好是在VS下面自己修改代码，用Debug来运行。

#### 转换二进制列表

将离队列表和升级经验转为文本文件。

用法为：

```c++
trans_bin_list(path + "list/levelup.bin", path + "list/levelup.txt");
trans_bin_list(path + "list/leave.bin", path + "list/leave.txt");
```
这两个文件通常来自pascal复刻版，某些lua版后来也有沿用。

实际上这两个就够了。

kys并没有处理武功武器配合。


#### 编号人物头像

```c++
//重新产生头像
void make_heads(std::string path)
```

从一个头像库里面选出头像，命名为初始存档的编号。

头像库可以从其他地方获取，git上没有保存。

更建议自行重配头像。

#### 检查脚本文件正确性

```c++
//检查3号指令的最后2个参数正确性
void check_script(std::string path)
```
只检查3号指令的最后两个参数是否合理。因修改器默认值问题，部分MOD对此参数处理有误，但DOS版的bug会使结果正确。复刻版修正了这个问题，故可能导致旧的部分剧情出错误。前述的转为lua脚本工具会处理，此处为验证。

#### 转换战斗帧数格式

```c++
//导出战斗帧数为文本
void trans_fight_frame(std::string path0)
```
仅用于转换金庸水浒传及相关MOD的战斗帧数格式。一般不需要。